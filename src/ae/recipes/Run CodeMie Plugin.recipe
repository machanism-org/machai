<Recipe name="Run CodeMie Plugin">
	<Command name="testConnection" os=".*"
		cmd="ping -w 20 nats-codemie.epmd-edp-anthos.eu.gcp.cloudapp.epam.com" />
	<Out name="testConnection" />
	<If name="testConnection"
		contains="Ping request could not find host">
		<Var name="!CodeMie Plugin Path" value="VPN Required" />
		<CheckValue actual="$var{testConnection}"
			onErrorMsg="VPN Required" />
	</If>
	<Command os=".*">taskkill /IM codemie-plugins.exe /F</Command>
	<Finally>
		<Remove name="!CodeMie Plugin Path" />
		<Command os=".*">taskkill /IM codemie-plugins.exe /F</Command>
	</Finally>
	<Out name="Project Dir" />
	<View name="output" reuse="true" type="Text" font="MONOSPACED" />
	<Var name="env" type="map">
		<item key="PYTHONIOENCODING">utf-8</item>
		<item key="PYTHONLEGACYWINDOWSSTDIO">utf-8</item>
	</Var>
	<Command name="output" os=".*" env="env"
		cmd="uvx codemie-plugins development run --repo-path $var{Project Dir}">
		<Out view="output" name="output" level="debug" />
		<If name="output"
			starts="Subscribed to NATS subjects, ready to serve">
			<Var name="!CodeMie Plugin Path" value="$var{Project Dir}" />
		</If>
	</Command>
</Recipe> 
